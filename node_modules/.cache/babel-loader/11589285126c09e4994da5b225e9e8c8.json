{"ast":null,"code":"// Load modules\nvar Fs = require('fs');\n\nvar Escape = require('./escape'); // Declare internals\n\n\nvar internals = {}; // Clone object or array\n\nexports.clone = function (obj, seen) {\n  if (typeof obj !== 'object' || obj === null) {\n    return obj;\n  }\n\n  seen = seen || {\n    orig: [],\n    copy: []\n  };\n  var lookup = seen.orig.indexOf(obj);\n\n  if (lookup !== -1) {\n    return seen.copy[lookup];\n  }\n\n  var newObj = obj instanceof Array ? [] : {};\n  seen.orig.push(obj);\n  seen.copy.push(newObj);\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (obj[i] instanceof Date) {\n        newObj[i] = new Date(obj[i].getTime());\n      } else if (obj[i] instanceof RegExp) {\n        var flags = '' + (obj[i].global ? 'g' : '') + (obj[i].ignoreCase ? 'i' : '') + (obj[i].multiline ? 'm' : '');\n        newObj[i] = new RegExp(obj[i].source, flags);\n      } else {\n        newObj[i] = exports.clone(obj[i], seen);\n      }\n    }\n  }\n\n  return newObj;\n}; // Merge all the properties of source into target, source wins in conflic, and by default null and undefined from source are applied\n\n\nexports.merge = function (target, source, isNullOverride\n/* = true */\n, isMergeArrays\n/* = true */\n) {\n  exports.assert(target && typeof target == 'object', 'Invalid target value: must be an object');\n  exports.assert(source === null || source === undefined || typeof source === 'object', 'Invalid source value: must be null, undefined, or an object');\n\n  if (!source) {\n    return target;\n  }\n\n  if (source instanceof Array) {\n    exports.assert(target instanceof Array, 'Cannot merge array onto an object');\n\n    if (isMergeArrays === false) {\n      // isMergeArrays defaults to true\n      target.length = 0; // Must not change target assignment\n    }\n\n    source.forEach(function (item) {\n      target.push(item);\n    });\n    return target;\n  }\n\n  Object.keys(source).forEach(function (key) {\n    var value = source[key];\n\n    if (value && typeof value === 'object') {\n      if (!target[key] || typeof target[key] !== 'object') {\n        target[key] = exports.clone(value);\n      } else {\n        exports.merge(target[key], source[key], isNullOverride, isMergeArrays);\n      }\n    } else {\n      if (value !== null && value !== undefined) {\n        // Explicit to preserve empty strings\n        target[key] = value;\n      } else if (isNullOverride !== false) {\n        // Defaults to true\n        target[key] = value;\n      }\n    }\n  });\n  return target;\n}; // Apply options to a copy of the defaults\n\n\nexports.applyToDefaults = function (defaults, options) {\n  exports.assert(defaults && typeof defaults == 'object', 'Invalid defaults value: must be an object');\n  exports.assert(!options || options === true || typeof options === 'object', 'Invalid options value: must be true, falsy or an object');\n\n  if (!options) {\n    // If no options, return null\n    return null;\n  }\n\n  var copy = exports.clone(defaults);\n\n  if (options === true) {\n    // If options is set to true, use defaults\n    return copy;\n  }\n\n  return exports.merge(copy, options, false, false);\n}; // Remove duplicate items from array\n\n\nexports.unique = function (array, key) {\n  var index = {};\n  var result = [];\n\n  for (var i = 0, il = array.length; i < il; ++i) {\n    var id = key ? array[i][key] : array[i];\n\n    if (index[id] !== true) {\n      result.push(array[i]);\n      index[id] = true;\n    }\n  }\n\n  return result;\n}; // Convert array into object\n\n\nexports.mapToObject = function (array, key) {\n  if (!array) {\n    return null;\n  }\n\n  var obj = {};\n\n  for (var i = 0, il = array.length; i < il; ++i) {\n    if (key) {\n      if (array[i][key]) {\n        obj[array[i][key]] = true;\n      }\n    } else {\n      obj[array[i]] = true;\n    }\n  }\n\n  return obj;\n}; // Find the common unique items in two arrays\n\n\nexports.intersect = function (array1, array2) {\n  if (!array1 || !array2) {\n    return [];\n  }\n\n  var common = [];\n  var hash = array1 instanceof Array ? exports.mapToObject(array1) : array1;\n  var found = {};\n\n  for (var i = 0, il = array2.length; i < il; ++i) {\n    if (hash[array2[i]] && !found[array2[i]]) {\n      common.push(array2[i]);\n      found[array2[i]] = true;\n    }\n  }\n\n  return common;\n}; // Find which keys are present\n\n\nexports.matchKeys = function (obj, keys) {\n  var matched = [];\n\n  for (var i = 0, il = keys.length; i < il; ++i) {\n    if (obj.hasOwnProperty(keys[i])) {\n      matched.push(keys[i]);\n    }\n  }\n\n  return matched;\n}; // Flatten array\n\n\nexports.flatten = function (array, target) {\n  var result = target || [];\n\n  for (var i = 0, il = array.length; i < il; ++i) {\n    if (Array.isArray(array[i])) {\n      exports.flatten(array[i], result);\n    } else {\n      result.push(array[i]);\n    }\n  }\n\n  return result;\n}; // Remove keys\n\n\nexports.removeKeys = function (object, keys) {\n  for (var i = 0, il = keys.length; i < il; i++) {\n    delete object[keys[i]];\n  }\n}; // Convert an object key chain string ('a.b.c') to reference (object[a][b][c])\n\n\nexports.reach = function (obj, chain) {\n  var path = chain.split('.');\n  var ref = obj;\n  path.forEach(function (level) {\n    if (ref) {\n      ref = ref[level];\n    }\n  });\n  return ref;\n}; // Inherits a selected set of methods from an object, wrapping functions in asynchronous syntax and catching errors\n\n\nexports.inheritAsync = function (self, obj, keys) {\n  keys = keys || null;\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (keys instanceof Array && keys.indexOf(i) < 0) {\n        continue;\n      }\n\n      self.prototype[i] = function (fn) {\n        return function (callback) {\n          var result = null;\n\n          try {\n            result = fn();\n          } catch (err) {\n            return callback(err);\n          }\n\n          return callback(null, result);\n        };\n      }(obj[i]);\n    }\n  }\n};\n\nexports.formatStack = function (stack) {\n  var trace = [];\n  stack.forEach(function (item) {\n    trace.push([item.getFileName(), item.getLineNumber(), item.getColumnNumber(), item.getFunctionName(), item.isConstructor()]);\n  });\n  return trace;\n};\n\nexports.formatTrace = function (trace) {\n  var display = [];\n  trace.forEach(function (row) {\n    display.push((row[4] ? 'new ' : '') + row[3] + ' (' + row[0] + ':' + row[1] + ':' + row[2] + ')');\n  });\n  return display;\n};\n\nexports.callStack = function (slice) {\n  // http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\n  var v8 = Error.prepareStackTrace;\n\n  Error.prepareStackTrace = function (err, stack) {\n    return stack;\n  };\n\n  var capture = {};\n  Error.captureStackTrace(capture, arguments.callee);\n  var stack = capture.stack;\n  Error.prepareStackTrace = v8;\n  var trace = exports.formatStack(stack);\n\n  if (slice) {\n    return trace.slice(slice);\n  }\n\n  return trace;\n};\n\nexports.displayStack = function (slice) {\n  var trace = exports.callStack(slice === undefined ? 1 : slice + 1);\n  return exports.formatTrace(trace);\n};\n\nexports.abortThrow = false;\n\nexports.abort = function (message, hideStack) {\n  if (process.env.NODE_ENV === 'test' || exports.abortThrow === true) {\n    throw new Error(message || 'Unknown error');\n  }\n\n  var stack = '';\n\n  if (!hideStack) {\n    stack = exports.displayStack(1).join('\\n\\t');\n  }\n\n  console.log('ABORT: ' + message + '\\n\\t' + stack);\n  process.exit(1);\n};\n\nexports.assert = function (condition, message) {\n  if (!condition) {\n    throw new Error(message || 'Unknown error');\n  }\n};\n\nexports.loadDirModules = function (path, excludeFiles, target) {\n  // target(filename, name, capName)\n  var exclude = {};\n\n  for (var i = 0, il = excludeFiles.length; i < il; ++i) {\n    exclude[excludeFiles[i] + '.js'] = true;\n  }\n\n  Fs.readdirSync(path).forEach(function (filename) {\n    if (/\\.js$/.test(filename) && !exclude[filename]) {\n      var name = filename.substr(0, filename.lastIndexOf('.'));\n      var capName = name.charAt(0).toUpperCase() + name.substr(1).toLowerCase();\n\n      if (typeof target !== 'function') {\n        target[capName] = require(path + '/' + name);\n      } else {\n        target(path + '/' + name, name, capName);\n      }\n    }\n  });\n};\n\nexports.rename = function (obj, from, to) {\n  obj[to] = obj[from];\n  delete obj[from];\n};\n\nexports.Timer = function () {\n  this.reset();\n};\n\nexports.Timer.prototype.reset = function () {\n  this.ts = Date.now();\n};\n\nexports.Timer.prototype.elapsed = function () {\n  return Date.now() - this.ts;\n}; // Load and parse package.json process root or given directory\n\n\nexports.loadPackage = function (dir) {\n  var result = {};\n  var filepath = (dir || process.env.PWD) + '/package.json';\n\n  if (Fs.existsSync(filepath)) {\n    try {\n      result = JSON.parse(Fs.readFileSync(filepath));\n    } catch (e) {}\n  }\n\n  return result;\n}; // Escape string for Regex construction\n\n\nexports.escapeRegex = function (string) {\n  // Escape ^$.*+-?=!:|\\/()[]{},\n  return string.replace(/[\\^\\$\\.\\*\\+\\-\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\,]/g, '\\\\$&');\n}; // Return an error as first argument of a callback\n\n\nexports.toss = function (condition\n/*, [message], callback */\n) {\n  var message = arguments.length === 3 ? arguments[1] : '';\n  var callback = arguments.length === 3 ? arguments[2] : arguments[1];\n  var err = message instanceof Error ? message : message ? new Error(message) : condition instanceof Error ? condition : new Error();\n\n  if (condition instanceof Error || !condition) {\n    return callback(err);\n  }\n}; // Base64url (RFC 4648) encode\n\n\nexports.base64urlEncode = function (value) {\n  return new Buffer(value, 'binary').toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=/g, '');\n}; // Base64url (RFC 4648) decode\n\n\nexports.base64urlDecode = function (encoded) {\n  if (encoded && !encoded.match(/^[\\w\\-]*$/)) {\n    return new Error('Invalid character');\n  }\n\n  try {\n    return new Buffer(encoded.replace(/-/g, '+').replace(/:/g, '/'), 'base64').toString('binary');\n  } catch (err) {\n    return err;\n  }\n}; // Escape attribute value for use in HTTP header\n\n\nexports.escapeHeaderAttribute = function (attribute) {\n  // Allowed value characters: !#$%&'()*+,-./:;<=>?@[]^_`{|}~ and space, a-z, A-Z, 0-9, \\, \"\n  exports.assert(attribute.match(/^[ \\w\\!#\\$%&'\\(\\)\\*\\+,\\-\\.\\/\\:;<\\=>\\?@\\[\\]\\^`\\{\\|\\}~\\\"\\\\]*$/), 'Bad attribute value (' + attribute + ')');\n  return attribute.replace(/\\\\/g, '\\\\\\\\').replace(/\\\"/g, '\\\\\"'); // Escape quotes and slash\n};\n\nexports.escapeHtml = function (string) {\n  return Escape.escapeHtml(string);\n};\n\nexports.escapeJavaScript = function (string) {\n  return Escape.escapeJavaScript(string);\n};\n/*\r\nvar event = {\r\n    timestamp: now.getTime(),\r\n    tags: ['tag'],\r\n    data: { some: 'data' }\r\n};\r\n*/\n\n\nexports.consoleFunc = console.log;\n\nexports.printEvent = function (event) {\n  var pad = function (value) {\n    return (value < 10 ? '0' : '') + value;\n  };\n\n  var now = new Date(event.timestamp);\n  var timestring = (now.getYear() - 100).toString() + pad(now.getMonth() + 1) + pad(now.getDate()) + '/' + pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds()) + '.' + now.getMilliseconds();\n  var data = event.data;\n\n  if (typeof event.data !== 'string') {\n    try {\n      data = JSON.stringify(event.data);\n    } catch (e) {\n      data = 'JSON Error: ' + e.message;\n    }\n  }\n\n  var output = timestring + ', ' + event.tags[0] + ', ' + data;\n  exports.consoleFunc(output);\n};","map":{"version":3,"sources":["C:/react/quiz/node_modules/hoek/lib/index.js"],"names":["Fs","require","Escape","internals","exports","clone","obj","seen","orig","copy","lookup","indexOf","newObj","Array","push","i","hasOwnProperty","Date","getTime","RegExp","flags","global","ignoreCase","multiline","source","merge","target","isNullOverride","isMergeArrays","assert","undefined","length","forEach","item","Object","keys","key","value","applyToDefaults","defaults","options","unique","array","index","result","il","id","mapToObject","intersect","array1","array2","common","hash","found","matchKeys","matched","flatten","isArray","removeKeys","object","reach","chain","path","split","ref","level","inheritAsync","self","prototype","fn","callback","err","formatStack","stack","trace","getFileName","getLineNumber","getColumnNumber","getFunctionName","isConstructor","formatTrace","display","row","callStack","slice","v8","Error","prepareStackTrace","capture","captureStackTrace","arguments","callee","displayStack","abortThrow","abort","message","hideStack","process","env","NODE_ENV","join","console","log","exit","condition","loadDirModules","excludeFiles","exclude","readdirSync","filename","test","name","substr","lastIndexOf","capName","charAt","toUpperCase","toLowerCase","rename","from","to","Timer","reset","ts","now","elapsed","loadPackage","dir","filepath","PWD","existsSync","JSON","parse","readFileSync","e","escapeRegex","string","replace","toss","base64urlEncode","Buffer","toString","base64urlDecode","encoded","match","escapeHeaderAttribute","attribute","escapeHtml","escapeJavaScript","consoleFunc","printEvent","event","pad","timestamp","timestring","getYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","data","stringify","output","tags"],"mappings":"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","sourcesContent":["// Load modules\r\n\r\nvar Fs = require('fs');\r\nvar Escape = require('./escape');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Clone object or array\r\n\r\nexports.clone = function (obj, seen) {\r\n\r\n    if (typeof obj !== 'object' ||\r\n        obj === null) {\r\n\r\n        return obj;\r\n    }\r\n\r\n    seen = seen || { orig: [], copy: [] };\r\n\r\n    var lookup = seen.orig.indexOf(obj);\r\n    if (lookup !== -1) {\r\n        return seen.copy[lookup];\r\n    }\r\n\r\n    var newObj = (obj instanceof Array) ? [] : {};\r\n\r\n    seen.orig.push(obj);\r\n    seen.copy.push(newObj);\r\n\r\n    for (var i in obj) {\r\n        if (obj.hasOwnProperty(i)) {\r\n            if (obj[i] instanceof Date) {\r\n                newObj[i] = new Date(obj[i].getTime());\r\n            }\r\n            else if (obj[i] instanceof RegExp) {\r\n                var flags = '' + (obj[i].global ? 'g' : '') + (obj[i].ignoreCase ? 'i' : '') + (obj[i].multiline ? 'm' : '');\r\n                newObj[i] = new RegExp(obj[i].source, flags);\r\n            }\r\n            else {\r\n                newObj[i] = exports.clone(obj[i], seen);\r\n            }\r\n        }\r\n    }\r\n\r\n    return newObj;\r\n};\r\n\r\n\r\n// Merge all the properties of source into target, source wins in conflic, and by default null and undefined from source are applied\r\n\r\nexports.merge = function (target, source, isNullOverride /* = true */, isMergeArrays /* = true */) {\r\n\r\n    exports.assert(target && typeof target == 'object', 'Invalid target value: must be an object');\r\n    exports.assert(source === null || source === undefined || typeof source === 'object', 'Invalid source value: must be null, undefined, or an object');\r\n\r\n    if (!source) {\r\n        return target;\r\n    }\r\n\r\n    if (source instanceof Array) {\r\n        exports.assert(target instanceof Array, 'Cannot merge array onto an object');\r\n        if (isMergeArrays === false) {                                                  // isMergeArrays defaults to true\r\n            target.length = 0;                                                          // Must not change target assignment\r\n        }\r\n\r\n        source.forEach(function (item) {\r\n\r\n            target.push(item);\r\n        });\r\n\r\n        return target;\r\n    }\r\n\r\n    Object.keys(source).forEach(function (key) {\r\n\r\n        var value = source[key];\r\n        if (value &&\r\n            typeof value === 'object') {\r\n\r\n            if (!target[key] ||\r\n                typeof target[key] !== 'object') {\r\n\r\n                target[key] = exports.clone(value);\r\n            }\r\n            else {\r\n                exports.merge(target[key], source[key], isNullOverride, isMergeArrays);\r\n            }\r\n        }\r\n        else {\r\n            if (value !== null && value !== undefined) {            // Explicit to preserve empty strings\r\n                target[key] = value;\r\n            }\r\n            else if (isNullOverride !== false) {                    // Defaults to true\r\n                target[key] = value;\r\n            }\r\n        }\r\n    });\r\n\r\n    return target;\r\n};\r\n\r\n\r\n// Apply options to a copy of the defaults\r\n\r\nexports.applyToDefaults = function (defaults, options) {\r\n\r\n    exports.assert(defaults && typeof defaults == 'object', 'Invalid defaults value: must be an object');\r\n    exports.assert(!options || options === true || typeof options === 'object', 'Invalid options value: must be true, falsy or an object');\r\n\r\n    if (!options) {                                                 // If no options, return null\r\n        return null;\r\n    }\r\n\r\n    var copy = exports.clone(defaults);\r\n\r\n    if (options === true) {                                         // If options is set to true, use defaults\r\n        return copy;\r\n    }\r\n\r\n    return exports.merge(copy, options, false, false);\r\n};\r\n\r\n\r\n// Remove duplicate items from array\r\n\r\nexports.unique = function (array, key) {\r\n\r\n    var index = {};\r\n    var result = [];\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n        var id = (key ? array[i][key] : array[i]);\r\n        if (index[id] !== true) {\r\n\r\n            result.push(array[i]);\r\n            index[id] = true;\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n\r\n// Convert array into object\r\n\r\nexports.mapToObject = function (array, key) {\r\n\r\n    if (!array) {\r\n        return null;\r\n    }\r\n\r\n    var obj = {};\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n        if (key) {\r\n            if (array[i][key]) {\r\n                obj[array[i][key]] = true;\r\n            }\r\n        }\r\n        else {\r\n            obj[array[i]] = true;\r\n        }\r\n    }\r\n\r\n    return obj;\r\n};\r\n\r\n\r\n// Find the common unique items in two arrays\r\n\r\nexports.intersect = function (array1, array2) {\r\n\r\n    if (!array1 || !array2) {\r\n        return [];\r\n    }\r\n\r\n    var common = [];\r\n    var hash = (array1 instanceof Array ? exports.mapToObject(array1) : array1);\r\n    var found = {};\r\n    for (var i = 0, il = array2.length; i < il; ++i) {\r\n        if (hash[array2[i]] && !found[array2[i]]) {\r\n            common.push(array2[i]);\r\n            found[array2[i]] = true;\r\n        }\r\n    }\r\n\r\n    return common;\r\n};\r\n\r\n\r\n// Find which keys are present\r\n\r\nexports.matchKeys = function (obj, keys) {\r\n\r\n    var matched = [];\r\n    for (var i = 0, il = keys.length; i < il; ++i) {\r\n        if (obj.hasOwnProperty(keys[i])) {\r\n            matched.push(keys[i]);\r\n        }\r\n    }\r\n    return matched;\r\n};\r\n\r\n\r\n// Flatten array\r\n\r\nexports.flatten = function (array, target) {\r\n\r\n    var result = target || [];\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n        if (Array.isArray(array[i])) {\r\n            exports.flatten(array[i], result);\r\n        }\r\n        else {\r\n            result.push(array[i]);\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n\r\n// Remove keys\r\n\r\nexports.removeKeys = function (object, keys) {\r\n\r\n    for (var i = 0, il = keys.length; i < il; i++) {\r\n        delete object[keys[i]];\r\n    }\r\n};\r\n\r\n\r\n// Convert an object key chain string ('a.b.c') to reference (object[a][b][c])\r\n\r\nexports.reach = function (obj, chain) {\r\n\r\n    var path = chain.split('.');\r\n    var ref = obj;\r\n    path.forEach(function (level) {\r\n\r\n        if (ref) {\r\n            ref = ref[level];\r\n        }\r\n    });\r\n\r\n    return ref;\r\n};\r\n\r\n\r\n// Inherits a selected set of methods from an object, wrapping functions in asynchronous syntax and catching errors\r\n\r\nexports.inheritAsync = function (self, obj, keys) {\r\n\r\n    keys = keys || null;\r\n\r\n    for (var i in obj) {\r\n        if (obj.hasOwnProperty(i)) {\r\n            if (keys instanceof Array &&\r\n                keys.indexOf(i) < 0) {\r\n\r\n                continue;\r\n            }\r\n\r\n            self.prototype[i] = (function (fn) {\r\n\r\n                return function (callback) {\r\n\r\n                    var result = null;\r\n                    try {\r\n                        result = fn();\r\n                    }\r\n                    catch (err) {\r\n                        return callback(err);\r\n                    }\r\n\r\n                    return callback(null, result);\r\n                };\r\n            })(obj[i]);\r\n        }\r\n    }\r\n};\r\n\r\n\r\nexports.formatStack = function (stack) {\r\n\r\n    var trace = [];\r\n    stack.forEach(function (item) {\r\n\r\n        trace.push([item.getFileName(), item.getLineNumber(), item.getColumnNumber(), item.getFunctionName(), item.isConstructor()]);\r\n    });\r\n\r\n    return trace;\r\n};\r\n\r\n\r\nexports.formatTrace = function (trace) {\r\n\r\n    var display = [];\r\n    trace.forEach(function (row) {\r\n\r\n        display.push((row[4] ? 'new ' : '') + row[3] + ' (' + row[0] + ':' + row[1] + ':' + row[2] + ')');\r\n    });\r\n\r\n    return display;\r\n};\r\n\r\n\r\nexports.callStack = function (slice) {\r\n\r\n    // http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\r\n\r\n    var v8 = Error.prepareStackTrace;\r\n    Error.prepareStackTrace = function (err, stack) {\r\n\r\n        return stack;\r\n    };\r\n\r\n    var capture = {};\r\n    Error.captureStackTrace(capture, arguments.callee);\r\n    var stack = capture.stack;\r\n\r\n    Error.prepareStackTrace = v8;\r\n\r\n    var trace = exports.formatStack(stack);\r\n\r\n    if (slice) {\r\n        return trace.slice(slice);\r\n    }\r\n\r\n    return trace;\r\n};\r\n\r\n\r\nexports.displayStack = function (slice) {\r\n\r\n    var trace = exports.callStack(slice === undefined ? 1 : slice + 1);\r\n\r\n    return exports.formatTrace(trace);\r\n};\r\n\r\n\r\nexports.abortThrow = false;\r\n\r\n\r\nexports.abort = function (message, hideStack) {\r\n\r\n    if (process.env.NODE_ENV === 'test' || exports.abortThrow === true) {\r\n        throw new Error(message || 'Unknown error');\r\n    }\r\n\r\n    var stack = '';\r\n    if (!hideStack) {\r\n        stack = exports.displayStack(1).join('\\n\\t');\r\n    }\r\n    console.log('ABORT: ' + message + '\\n\\t' + stack);\r\n    process.exit(1);\r\n};\r\n\r\n\r\nexports.assert = function (condition, message) {\r\n\r\n    if (!condition) {\r\n        throw new Error(message || 'Unknown error');\r\n    }\r\n};\r\n\r\n\r\nexports.loadDirModules = function (path, excludeFiles, target) {      // target(filename, name, capName)\r\n\r\n    var exclude = {};\r\n    for (var i = 0, il = excludeFiles.length; i < il; ++i) {\r\n        exclude[excludeFiles[i] + '.js'] = true;\r\n    }\r\n\r\n    Fs.readdirSync(path).forEach(function (filename) {\r\n\r\n        if (/\\.js$/.test(filename) &&\r\n            !exclude[filename]) {\r\n\r\n            var name = filename.substr(0, filename.lastIndexOf('.'));\r\n            var capName = name.charAt(0).toUpperCase() + name.substr(1).toLowerCase();\r\n\r\n            if (typeof target !== 'function') {\r\n                target[capName] = require(path + '/' + name);\r\n            }\r\n            else {\r\n                target(path + '/' + name, name, capName);\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n\r\nexports.rename = function (obj, from, to) {\r\n\r\n    obj[to] = obj[from];\r\n    delete obj[from];\r\n};\r\n\r\n\r\nexports.Timer = function () {\r\n\r\n    this.reset();\r\n};\r\n\r\n\r\nexports.Timer.prototype.reset = function () {\r\n\r\n    this.ts = Date.now();\r\n};\r\n\r\n\r\nexports.Timer.prototype.elapsed = function () {\r\n\r\n    return Date.now() - this.ts;\r\n};\r\n\r\n\r\n// Load and parse package.json process root or given directory\r\n\r\nexports.loadPackage = function (dir) {\r\n\r\n    var result = {};\r\n    var filepath = (dir || process.env.PWD) + '/package.json';\r\n    if (Fs.existsSync(filepath)) {\r\n        try {\r\n            result = JSON.parse(Fs.readFileSync(filepath));\r\n        }\r\n        catch (e) { }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n\r\n// Escape string for Regex construction\r\n\r\nexports.escapeRegex = function (string) {\r\n\r\n    // Escape ^$.*+-?=!:|\\/()[]{},\r\n    return string.replace(/[\\^\\$\\.\\*\\+\\-\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\,]/g, '\\\\$&');\r\n};\r\n\r\n\r\n// Return an error as first argument of a callback\r\n\r\nexports.toss = function (condition /*, [message], callback */) {\r\n\r\n    var message = (arguments.length === 3 ? arguments[1] : '');\r\n    var callback = (arguments.length === 3 ? arguments[2] : arguments[1]);\r\n\r\n    var err = (message instanceof Error ? message : (message ? new Error(message) : (condition instanceof Error ? condition : new Error())));\r\n\r\n    if (condition instanceof Error ||\r\n        !condition) {\r\n\r\n        return callback(err);\r\n    }\r\n};\r\n\r\n\r\n// Base64url (RFC 4648) encode\r\n\r\nexports.base64urlEncode = function (value) {\r\n\r\n    return (new Buffer(value, 'binary')).toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=/g, '');\r\n};\r\n\r\n\r\n// Base64url (RFC 4648) decode\r\n\r\nexports.base64urlDecode = function (encoded) {\r\n\r\n    if (encoded &&\r\n        !encoded.match(/^[\\w\\-]*$/)) {\r\n\r\n        return new Error('Invalid character');\r\n    }\r\n\r\n    try {\r\n        return (new Buffer(encoded.replace(/-/g, '+').replace(/:/g, '/'), 'base64')).toString('binary');\r\n    }\r\n    catch (err) {\r\n        return err;\r\n    }\r\n};\r\n\r\n\r\n// Escape attribute value for use in HTTP header\r\n\r\nexports.escapeHeaderAttribute = function (attribute) {\r\n\r\n    // Allowed value characters: !#$%&'()*+,-./:;<=>?@[]^_`{|}~ and space, a-z, A-Z, 0-9, \\, \"\r\n\r\n    exports.assert(attribute.match(/^[ \\w\\!#\\$%&'\\(\\)\\*\\+,\\-\\.\\/\\:;<\\=>\\?@\\[\\]\\^`\\{\\|\\}~\\\"\\\\]*$/), 'Bad attribute value (' + attribute + ')');\r\n\r\n    return attribute.replace(/\\\\/g, '\\\\\\\\').replace(/\\\"/g, '\\\\\"');                             // Escape quotes and slash\r\n};\r\n\r\n\r\nexports.escapeHtml = function (string) {\r\n\r\n    return Escape.escapeHtml(string);\r\n};\r\n\r\n\r\nexports.escapeJavaScript = function (string) {\r\n\r\n    return Escape.escapeJavaScript(string);\r\n};\r\n\r\n\r\n/*\r\nvar event = {\r\n    timestamp: now.getTime(),\r\n    tags: ['tag'],\r\n    data: { some: 'data' }\r\n};\r\n*/\r\n\r\nexports.consoleFunc = console.log;\r\n\r\nexports.printEvent = function (event) {\r\n\r\n    var pad = function (value) {\r\n\r\n        return (value < 10 ? '0' : '') + value;\r\n    };\r\n\r\n    var now = new Date(event.timestamp);\r\n    var timestring = (now.getYear() - 100).toString() +\r\n        pad(now.getMonth() + 1) +\r\n        pad(now.getDate()) +\r\n        '/' +\r\n        pad(now.getHours()) +\r\n        pad(now.getMinutes()) +\r\n        pad(now.getSeconds()) +\r\n        '.' +\r\n        now.getMilliseconds();\r\n\r\n    var data = event.data;\r\n    if (typeof event.data !== 'string') {\r\n        try {\r\n            data = JSON.stringify(event.data);\r\n        }\r\n        catch (e) {\r\n            data = 'JSON Error: ' + e.message;\r\n        }\r\n    }\r\n\r\n    var output = timestring + ', ' + event.tags[0] + ', ' + data;\r\n    exports.consoleFunc(output);\r\n};\r\n"]},"metadata":{},"sourceType":"script"}