{"ast":null,"code":"// Copyright 2011 Timothy J Fontaine <tjfontaine@gmail.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE\n'use strict';\n\nvar dgram = require('dgram'),\n    EventEmitter = require('events').EventEmitter,\n    net = require('net'),\n    util = require('util'),\n    UDPSocket = require('./utils').UDPSocket,\n    TCPSocket = require('./utils').TCPSocket,\n    Packet = require('./packet');\n\nvar Server = function (opts) {\n  var self = this;\n\n  this._socket.on('listening', function () {\n    self.emit('listening');\n  });\n\n  this._socket.on('close', function () {\n    self.emit('close');\n  });\n\n  this._socket.on('error', function (err) {\n    self.emit('socketError', err, self._socket);\n  });\n};\n\nutil.inherits(Server, EventEmitter);\n\nServer.prototype.close = function () {\n  this._socket.close();\n};\n\nServer.prototype.address = function () {\n  return this._socket.address();\n};\n\nServer.prototype.handleMessage = function (msg, remote, address) {\n  var request,\n      response = new Packet(remote);\n\n  try {\n    request = Packet.parse(msg, remote);\n    request.address = address;\n    response.header.id = request.header.id;\n    response.header.qr = 1;\n    response.question = request.question;\n    this.emit('request', request, response);\n  } catch (e) {\n    this.emit('error', e, msg, response);\n  }\n};\n\nvar UDPServer = function (opts) {\n  var self = this;\n  this._socket = dgram.createSocket(opts.dgram_type || 'udp4');\n\n  this._socket.on('message', function (msg, remote) {\n    self.handleMessage(msg, new UDPSocket(self._socket, remote), remote);\n  });\n\n  Server.call(this, opts);\n};\n\nutil.inherits(UDPServer, Server);\n\nUDPServer.prototype.serve = function (port, address) {\n  this._socket.bind(port, address);\n};\n\nvar TCPServer = function (opts) {\n  var self = this;\n  this._socket = net.createServer(function (client) {\n    var tcp = new TCPSocket(client);\n    var address = client.address();\n    tcp.on('message', function (msg, remote) {\n      self.handleMessage(msg, tcp, address);\n    });\n    tcp.catchMessages();\n  });\n  Server.call(this, opts);\n};\n\nutil.inherits(TCPServer, Server);\n\nTCPServer.prototype.serve = function (port, address) {\n  this._socket.listen(port, address);\n};\n\nexports.createServer = function (opts) {\n  return new UDPServer(opts || {});\n};\n\nexports.createUDPServer = function (opts) {\n  return exports.createServer(opts);\n};\n\nexports.createTCPServer = function (opts) {\n  return new TCPServer(opts || {});\n};","map":{"version":3,"sources":["C:/react/quiz/node_modules/native-dns/lib/server.js"],"names":["dgram","require","EventEmitter","net","util","UDPSocket","TCPSocket","Packet","Server","opts","self","_socket","on","emit","err","inherits","prototype","close","address","handleMessage","msg","remote","request","response","parse","header","id","qr","question","e","UDPServer","createSocket","dgram_type","call","serve","port","bind","TCPServer","createServer","client","tcp","catchMessages","listen","exports","createUDPServer","createTCPServer"],"mappings":"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","sourcesContent":["// Copyright 2011 Timothy J Fontaine <tjfontaine@gmail.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE\n\n'use strict';\n\nvar dgram = require('dgram'),\n    EventEmitter = require('events').EventEmitter,\n    net = require('net'),\n    util = require('util'),\n    UDPSocket = require('./utils').UDPSocket,\n    TCPSocket = require('./utils').TCPSocket,\n    Packet = require('./packet');\n\nvar Server = function(opts) {\n  var self = this;\n\n  this._socket.on('listening', function() {\n    self.emit('listening');\n  });\n\n  this._socket.on('close', function() {\n    self.emit('close');\n  });\n\n  this._socket.on('error', function(err) {\n    self.emit('socketError', err, self._socket);\n  });\n};\nutil.inherits(Server, EventEmitter);\n\nServer.prototype.close = function() {\n  this._socket.close();\n};\n\nServer.prototype.address = function() {\n  return this._socket.address();\n};\n\nServer.prototype.handleMessage = function(msg, remote, address) {\n  var request, response = new Packet(remote);\n\n  try {\n    request = Packet.parse(msg, remote);\n\n    request.address = address;\n\n    response.header.id = request.header.id;\n    response.header.qr = 1;\n    response.question = request.question;\n\n    this.emit('request', request, response);\n  } catch (e) {\n    this.emit('error', e, msg, response);\n  }\n};\n\nvar UDPServer = function(opts) {\n  var self = this;\n\n  this._socket = dgram.createSocket(opts.dgram_type || 'udp4');\n\n  this._socket.on('message', function(msg, remote) {\n    self.handleMessage(msg, new UDPSocket(self._socket, remote), remote);\n  });\n\n  Server.call(this, opts);\n};\nutil.inherits(UDPServer, Server);\n\nUDPServer.prototype.serve = function(port, address) {\n  this._socket.bind(port, address);\n};\n\nvar TCPServer = function(opts) {\n  var self = this;\n\n  this._socket = net.createServer(function(client) {\n    var tcp = new TCPSocket(client);\n    var address = client.address();\n    tcp.on('message', function(msg, remote) {\n      self.handleMessage(msg, tcp, address);\n    });\n    tcp.catchMessages();\n  });\n\n  Server.call(this, opts);\n};\nutil.inherits(TCPServer, Server);\n\nTCPServer.prototype.serve = function(port, address) {\n  this._socket.listen(port, address);\n};\n\nexports.createServer = function(opts) {\n  return new UDPServer(opts || {});\n};\n\nexports.createUDPServer = function(opts) {\n  return exports.createServer(opts);\n};\n\nexports.createTCPServer = function(opts) {\n  return new TCPServer(opts || {});\n};\n"]},"metadata":{},"sourceType":"script"}